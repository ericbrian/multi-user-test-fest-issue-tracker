<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test Fest Tracker</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>

<body>
  <div class="site-header">
    <strong class="site-title">Test Fest Issue Tracker</strong>
    <div class="room-controls">
      <div class="room-selection-area">
        <div id="currentRoomName" class="current-room-name" style="display: none">
          <span class="room-icon">üè† Test Fest:</span>
          <span class="room-name-text"></span>
        </div>
        <label id="roomLabel" for="roomSelect">Room</label>
        <select id="roomSelect"></select>
        <button id="createRoomBtn" title="Create a new Test Fest" aria-label="Create new Test Fest" class="icon-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M12 5v14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button id="changeRoomBtn" class="icon-btn" style="display: none" title="Change Test Fest" aria-label="Change Test Fest">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M3 12h13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 5l6 7-6 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="user-controls">
      <div id="loginNote" class="login-note">Log in to start!</div>
      <div id="userInfoHeader" class="user-info"></div>
      <button id="loginBtn" style="display: none">Login</button>
      <button id="logoutBtn" class="btn-danger" style="display: none">
        Logout
      </button>
    </div>
  <div id="authCenter" class="auth-center hidden" aria-hidden="true">
    <div class="auth-card">
      <div class="auth-card-title">Welcome to Test Fest Issue Tracker</div>
      <div class="auth-card-desc">Sign in to join a Test Fest, report issues, and view team issues.</div>
      <div class="auth-card-actions">
        <button id="loginCenterBtn" onclick="window.location.href='/auth/login'">Log in</button>
      </div>
    </div>
  </div>
  <!-- Room chooser shown to authenticated users who are not in a room -->
  <div id="roomChooserCenter" class="auth-center hidden" aria-hidden="true">
    <div class="auth-card">
      <div class="auth-card-title">Join or create a Test Fest</div>
      <div class="auth-card-desc">Select an existing room or create a new Test Fest to get started.</div>
      <div class="auth-card-actions" style="width:100%; gap:8px;">
        <select id="roomChooserSelect" style="flex:1; min-width:0; padding:8px 10px; border-radius:8px; border:1px solid var(--border); background:transparent; color:var(--text);">
          <option value="">‚Äî Select a Test ‚Äî</option>
        </select>
        <button id="roomChooserJoinBtn" disabled>Join</button>
      </div>
      <div style="margin-top:12px; display:flex; justify-content:center;">
        <button id="roomChooserCreateBtn" aria-label="Create new Test Fest" class="icon-btn"> 
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M12 5v14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  </div>
  <div class="layout">
    <div class="left">
      <div class="topbar"></div>
      <form id="issueForm" class="hidden" style="margin-top: 12px">
          <!-- Test Script selector moved to topbar; keep a hidden input so form submission still includes scriptId -->
          <input id="scriptId" name="scriptId" type="hidden" />

          <label for="description">Issue Description <span id="selectedScriptBadge" class="selected-script-badge" style="display:none" aria-hidden="true"></span></label>
          <textarea id="description" name="description" rows="4" required></textarea>

          <label>Reason for logging?</label>
          <div class="reasons">
            <label><input type="checkbox" name="is_issue" checked /> New Issue</label>
            <label><input type="checkbox" name="is_existing_upper_env" /> Issue already in
              Production</label>
            <label><input type="checkbox" name="is_annoyance" /> Annoyance</label>
            <label><input type="checkbox" name="is_not_sure_how_to_test" /> Not
              sure how to test</label>
          </div>

          <label>Images</label>
          <div id="imagesDropzone" class="images-dropzone" tabindex="0" role="button" aria-label="Drop images here or click to browse">Drop images here or click to browse</div>
          <input id="images" name="images" type="file" accept="image/*" multiple style="display:none" />
          <div class="form-actions">
            <button type="submit">Save Issue</button>
          </div>
        </form>
      <!-- left auth placeholder removed; use centered auth/chooser instead -->
    </div>
    <div class="right">
      <div class="right-header">
        <h2 class="section-title" style="margin:0;">Issues Reported by All Testers</h2>
        <div class="right-header-controls" style="display:flex; align-items:center; gap:12px;">
          <div class="issues-filter">
            <label for="issuesFilter" class="filter-label">Filter</label>
            <select id="issuesFilter" aria-label="Filter issues">
              <option value="all">All</option>
              <option value="mine">Only mine</option>
              <option value="theirs">Only theirs</option>
              <option value="no-placeholders">No placeholders</option>
            </select>
          </div>
        </div>
      </div>
      <!-- right auth placeholder removed; use centered auth/chooser instead -->
      <div class="right-scroll">
        <div class="topbar">
          <div id="tagLegend" class="hidden"></div>
        </div>
        <div id="issues" class="hidden"></div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script type="module" src="/static/js/main.js"></script>
</body>

</html>
